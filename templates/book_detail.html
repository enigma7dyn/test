{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ book.title }} - –î–µ—Ç–∞–ª–∏ –∫–Ω–∏–≥–∏</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body class="dashboard-body">
    <div class="header">
        <div class="welcome">
            üìö {{ book.title }}
        </div>
        <div class="header-actions">
            <a href="{% url 'favorites_list' %}" class="btn-small btn-secondary">‚ù§Ô∏è –ò–∑–±—Ä–∞–Ω–Ω–æ–µ</a>
            <a href="{% url 'add_book' %}" class="btn-small btn-primary">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É</a>
            <a href="{% url 'user_dashboard' %}" class="btn-small btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
            <a href="{% url 'index' %}" class="logout-btn">–í—ã–π—Ç–∏</a>
        </div>
    </div>
    
    {% if messages %}
        {% for message in messages %}
            <div class="message {% if message.tags %}{{ message.tags }}{% endif %}">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}
    
    <div class="book-detail-container">
        <div class="book-main-info">
            <div class="book-cover">
                <div class="cover-placeholder">üìñ</div>
            </div>
            <div class="book-info">
                <h1 class="book-title">{{ book.title }}</h1>
                <div class="book-author">–ê–≤—Ç–æ—Ä: {{ book.author }}</div>
                <div class="book-date">–î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏: {{ book.published_date }}</div>
                <div class="book-rating">
                    <span class="rating-stars">
                        {% if book.average_rating >= 1 %}‚≠ê{% endif %}
                        {% if book.average_rating >= 2 %}‚≠ê{% endif %}
                        {% if book.average_rating >= 3 %}‚≠ê{% endif %}
                        {% if book.average_rating >= 4 %}‚≠ê{% endif %}
                        {% if book.average_rating >= 5 %}‚≠ê{% endif %}
                    </span>
                    <span class="rating-text">{{ book.average_rating|floatformat:1 }}/5.0</span>
                </div>
                <div class="book-actions">
                    {% if is_favorite %}
                        <a href="{% url 'remove_from_favorites' book.id %}" class="btn-small btn-danger">‚ù§Ô∏è –£–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ</a>
                    {% else %}
                        <a href="{% url 'add_to_favorites' book.id %}" class="btn-small btn-secondary">ü§ç –î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</a>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <div class="reviews-section">
            <h2>üìù –†–µ—Ü–µ–Ω–∑–∏–∏ ({{ book.reviews.count }})</h2>
            
            {% if not user_review %}
                <div class="review-form-container">
                    <h3>‚úçÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å —Ä–µ—Ü–µ–Ω–∑–∏—é</h3>
                    <form method="post" action="{% url 'add_review' book.id %}" class="review-form" id="reviewForm">
                        {% csrf_token %}
                        <div class="form-group">
                            <label for="rating">–û—Ü–µ–Ω–∫–∞ *</label>
                            <select name="rating" id="rating" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É</option>
                                <option value="5">5 - –û—Ç–ª–∏—á–Ω–æ</option>
                                <option value="4">4 - –•–æ—Ä–æ—à–æ</option>
                                <option value="3">3 - –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ</option>
                                <option value="2">2 - –ü–ª–æ—Ö–æ</option>
                                <option value="1">1 - –û—á–µ–Ω—å –ø–ª–æ—Ö–æ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="text">–¢–µ–∫—Å—Ç —Ä–µ—Ü–µ–Ω–∑–∏–∏ *</label>
                            <textarea name="text" id="text" rows="4" required placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à—É —Ä–µ—Ü–µ–Ω–∑–∏—é..."></textarea>
                        </div>
                        <button type="submit" class="btn-small btn-primary">üìù –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Ä–µ—Ü–µ–Ω–∑–∏—é</button>
                    </form>
                </div>
            {% else %}
                <div class="user-review-notice">
                    <p>‚úÖ –í—ã —É–∂–µ –Ω–∞–ø–∏—Å–∞–ª–∏ —Ä–µ—Ü–µ–Ω–∑–∏—é –Ω–∞ —ç—Ç—É –∫–Ω–∏–≥—É</p>
                </div>
            {% endif %}
            
            {% if book.reviews.all %}
                <div class="reviews-list">
                    {% for review in book.reviews.all %}
                        <div class="review-card">
                            <div class="review-header">
                                <span class="review-author">{{ review.user }}</span>
                                <span class="review-date">{{ review.created_at|date:"d.m.Y" }}</span>
                            </div>
                            <div class="review-rating">
                                –û—Ü–µ–Ω–∫–∞: 
                                {% for i in "12345" %}
                                    {% if forloop.counter <= review.rating %}‚≠ê{% else %}‚òÜ{% endif %}
                                {% endfor %}
                                <span class="rating-number">({{ review.rating }}/5)</span>
                            </div>
                            <div class="review-text">{{ review.text }}</div>
                            
                            
                            {% if review.user == user.username %}
                                <div class="review-actions">
                                    <a href="{% url 'edit_review' review.id %}" class="btn-small btn-secondary">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                                    <a href="{% url 'delete_review' review.id %}" class="btn-small btn-danger" onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ä–µ—Ü–µ–Ω–∑–∏—é?')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</a>
                                </div>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="no-reviews">
                    <p>üìù –ü–æ–∫–∞ –Ω–µ—Ç —Ä–µ—Ü–µ–Ω–∑–∏–π –Ω–∞ —ç—Ç—É –∫–Ω–∏–≥—É. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>
                </div>
            {% endif %}
        </div>
    </div>
</body>
</html> 