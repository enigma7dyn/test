{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—Ü–µ–Ω–∑–∏—é</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body class="dashboard-body">
    <div class="header">
        <div class="welcome">
            ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—Ü–µ–Ω–∑–∏—é
        </div>
        <div class="header-actions">
            <a href="{% url 'book_detail' review.book.id %}" class="btn-small btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ –∫–Ω–∏–≥–µ</a>
            <a href="{% url 'index' %}" class="logout-btn">–í—ã–π—Ç–∏</a>
        </div>
    </div>
    
    {% if messages %}
        {% for message in messages %}
            <div class="message {% if message.tags %}{{ message.tags }}{% endif %}">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}
    
    <div class="edit-review-container">
        <div class="book-info-summary">
            <h3>üìö {{ review.book.title }}</h3>
            <p>–ê–≤—Ç–æ—Ä: {{ review.book.author }}</p>
        </div>
        
        <form method="post" class="edit-review-form" id="editReviewForm">
            {% csrf_token %}
            
            <div class="form-group">
                <label for="rating">–û—Ü–µ–Ω–∫–∞ *</label>
                <select name="rating" id="rating" required>
                    <option value="5" {% if review.rating == 5 %}selected{% endif %}>5 - –û—Ç–ª–∏—á–Ω–æ</option>
                    <option value="4" {% if review.rating == 4 %}selected{% endif %}>4 - –•–æ—Ä–æ—à–æ</option>
                    <option value="3" {% if review.rating == 3 %}selected{% endif %}>3 - –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ</option>
                    <option value="2" {% if review.rating == 2 %}selected{% endif %}>2 - –ü–ª–æ—Ö–æ</option>
                    <option value="1" {% if review.rating == 1 %}selected{% endif %}>1 - –û—á–µ–Ω—å –ø–ª–æ—Ö–æ</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="text">–¢–µ–∫—Å—Ç —Ä–µ—Ü–µ–Ω–∑–∏–∏ *</label>
                <textarea name="text" id="text" rows="6" required>{{ review.text }}</textarea>
            </div>
            
            <div class="form-actions">
                <button type="submit" class="btn-small btn-primary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                <a href="{% url 'book_detail' review.book.id %}" class="btn-small btn-secondary">‚ùå –û—Ç–º–µ–Ω–∞</a>
            </div>
        </form>
    </div>

    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è CSRF —Ç–æ–∫–µ–Ω–∞
        function updateCSRFToken() {
            fetch('{% url "edit_review" review.id %}')
                .then(response => {
                    const token = document.querySelector('[name=csrfmiddlewaretoken]');
                    if (token) {
                        const newToken = response.headers.get('X-CSRFToken');
                        if (newToken) {
                            token.value = newToken;
                        }
                    }
                })
                .catch(error => console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è CSRF —Ç–æ–∫–µ–Ω–∞:', error));
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º CSRF —Ç–æ–∫–µ–Ω –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
        setInterval(updateCSRFToken, 300000);

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–∫–µ–Ω –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            updateCSRFToken();
        });
    </script>
</body>
</html> 